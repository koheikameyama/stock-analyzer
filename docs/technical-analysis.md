# テクニカル分析機能

## 概要

AI株式分析にテクニカル指標（移動平均、RSI）を追加し、トレンド分析を実施する機能。

## 計算される指標

### 移動平均（SMA）
- **5日移動平均**: 短期トレンドの把握
- **25日移動平均**: 中期トレンドの把握

### RSI（相対力指数）
- **14日RSI**: 買われすぎ/売られすぎの判定
  - 70以上: 買われすぎ
  - 30以下: 売られすぎ
  - 30-70: 中立

## トレンド判定ロジック

### 上昇トレンド
- 条件: `5日移動平均 > 25日移動平均` かつ `現在価格 > 5日移動平均`

### 下降トレンド
- 条件: `5日移動平均 < 25日移動平均` かつ `現在価格 < 5日移動平均`

### 横ばい
- 条件: 上記以外

## シグナル検出

### ゴールデンクロス
- 5日移動平均が25日移動平均を下から上に抜ける
- 買いシグナル

### デッドクロス
- 5日移動平均が25日移動平均を上から下に抜ける
- 売りシグナル

## 使用方法

```python
from technical_analysis import calculate_trend_indicators, analyze_trend

# 株価履歴から指標を計算
indicators = calculate_trend_indicators(price_history)

# トレンドを判定
trend_info = analyze_trend(indicators)

print(trend_info)
# {
#   'trend': '上昇',
#   'sma_5': 1500.0,
#   'sma_25': 1400.0,
#   'rsi': 65.5,
#   'rsi_signal': '中立',
#   'signals': ['ゴールデンクロス発生']
# }
```

## データ要件

- **最低日数**: 25日分の株価履歴
- **必須カラム**: `date`, `close`
- **推奨カラム**: `open`, `high`, `low`, `volume`

## エラーハンドリング

- データ不足（25日未満）: トレンド分析をスキップ、既存の分析を継続
- 計算エラー: ログに警告を出力、既存の分析を継続
- 必須カラム不足: ValueErrorを発生

## テスト

```bash
cd batch
python3 -m pytest tests/test_technical_analysis.py -v
```

## 依存関係

- ta==0.11.0
- pandas==2.3.3
- numpy==2.4.1

## AI分析への統合

テクニカル分析の結果は、AIプロンプトに以下の形式で追加されます：

```
【株価トレンド分析】
- トレンド: 上昇
- 5日移動平均: 1500円
- 25日移動平均: 1400円
- RSI(14日): 65.5 (中立)
- シグナル: ゴールデンクロス発生
```

これにより、AIは財務指標に加えて株価の動きも考慮した総合的な投資判断を行います。
