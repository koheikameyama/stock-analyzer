# Claude Code 設定

## 言語設定

**すべての出力は日本語で行ってください。**

- ユーザーとのコミュニケーションは日本語で行う
- コードコメントは日本語で記述する
- ドキュメント、仕様書、README等も日本語で作成する
- エラーメッセージや説明も日本語で提供する

## コミュニケーションルール

**質問は1つずつ行ってください。**

- ユーザーに質問をする際は、一度に1つの質問のみを行う
- 複数の質問がある場合でも、1つずつ順番に聞く
- ユーザーが回答した後、次の質問に進む

## 開発フロー

**ブランチ運用に従って開発してください。**

### 🚨 絶対に守るべきルール

**mainブランチへの直接操作は絶対に禁止です。**

- ❌ **mainブランチへの直接push禁止**
- ❌ **mainブランチへの直接merge禁止**
- ❌ **mainブランチへのforce push禁止**
- ✅ **すべての変更は必ずPR経由で行う**
- ✅ **PRのマージはユーザーが手動で行う（自動マージ禁止）**

### ⚠️ 重要：ブランチ作成ルール

**すべての変更作業はfeatureブランチで行ってください。**

- **新機能・破壊的変更**: 必ずブランチ経由で PR を作成 → version:major/minor ラベル付与
- **バグ修正・軽微な改善**: 必ずブランチ経由で PR を作成 → ラベルなし
- **⚠️ 既にマージされたブランチは絶対に使わない**
  - 常に最新のmainから新しいブランチを作成する
  - マージ済みブランチを再利用すると、古いコミットやコンフリクトが発生する
- ブランチ名の例:
  - `feature/リリースノート機能`
  - `feature/issue-33-design-improvement`
  - `feature/ポートフォリオ機能`
  - `fix/mobile-ui-bug`

### ブランチ作成確認

作業を始める前に、必ずユーザーに確認してください：

**質問例:**
- 「この作業用に `feature/〇〇` ブランチを作成しますか？」
- 「この新機能は `version:minor` でリリースしますか？」
- 「バグ修正なのでラベルなしで良いですか？」

### PR作成時の注意

PR作成時は、適切なバージョンラベルを提案してください。

**バージョンラベルの使い分けルール:**

- **version:major** - 破壊的変更
  - ユーザーに大きな影響がある変更
  - 例: API仕様変更、既存機能削除
  - 即座にリリース作成・通知

- **version:minor** - 新機能追加
  - ユーザーに新しい価値を提供する変更
  - 例: 新しいページ追加、新機能実装
  - 即座にリリース作成・通知

- **version:patch** - ⚠️ ユーザーに影響のあるバグ修正のみ
  - ユーザーが困っている問題の修正
  - 例: ボタンが押せない、画面が表示されない、データが正しく表示されない
  - 即座にリリース作成・通知

- **ラベルなし** - 内部的な修正・改善
  - パフォーマンス改善、リファクタリング、内部エラー修正
  - 例: N+1問題修正、接続プール最適化、ドキュメント更新
  - リリース作成なし

**バージョンラベル（major/minor）で実行される処理:**
- GitHub Release作成
- Slack通知
- X投稿テンプレート生成
- `/releases`ページに表示
- リリースモーダル表示

**確認する質問例:**
- 「このPRには `version:minor` ラベルを付けますか？（新機能追加のため）」
- 「破壊的変更なので `version:major` ラベルを付けますか？」
- 「バグ修正なのでラベルなしで良いですか？（次のminorリリースに含まれます）」

### 自動リリースの流れ

1. PR作成 + version:major または version:minor ラベル付与
2. main にマージ
3. 自動的にバージョン計算してGitHub Release作成
4. Slack通知（X投稿候補付き）
5. ユーザーが手動でX投稿
6. リリースモーダルが自動表示

### 詳細ドキュメント

詳しくは [ブランチ運用戦略](./docs/branch_strategy.md) を参照してください。

## Issue管理

**新しいissueを作成したら、必ずプロジェクトに追加してください。**

### Issue作成時の手順

1. `gh issue create` でissueを作成
2. 作成されたissue番号を確認
3. 以下のコマンドでプロジェクトに追加：
   ```bash
   gh project item-add 2 --owner koheikameyama --url https://github.com/koheikameyama/stock-analyzer/issues/<ISSUE_NUMBER>
   ```

### プロジェクト情報

- **プロジェクト番号**: 2
- **プロジェクト名**: Stock Analyzer Development
- **Owner**: koheikameyama

### 例

```bash
# Issue作成
gh issue create --title "新機能" --body "説明" --label "enhancement"
# → Issue #44 が作成される

# プロジェクトに追加
gh project item-add 2 --owner koheikameyama --url https://github.com/koheikameyama/stock-analyzer/issues/44
```

**重要: issueを作成したら、必ずプロジェクトへの追加も実行してください。**

## コミットメッセージ・PR本文

**「🤖 Generated with [Claude Code]」は含めないでください。**

- コミットメッセージに含めない
- PRの本文に含めない
- シンプルで読みやすいメッセージを心がける

## 例外

- コード自体（変数名、関数名、クラス名など）は英語で記述する
- commit メッセージは英語または日本語（プロジェクトの慣習に従う）
